{% extends 'base.html' %}

{% block title %}

    Lista de Tickets - {{ block.super }}

{% endblock title %}

{% block body %}

    <div class="container">
        <br />
        <h5><b>Lista de Voos x Tickets</b></h5>
        <!-- <h5><b>Lista de Tickets</b></h5> -->
        <div class="row">
            <div class ="col-md-12">

                <br />
                <a href="{% url 'tickets:add_ticket' %}">Cadastro de novo ticket</a>
                <br />
                <br />
    

            <br />
                <table class="table table-hover">
                <thead>
                    <tr>
                    <th scope="col">#</th>
                    <!-- <th scope="col">Status</th>-->
                    <th scope="col">Voo</th>
                    <th scope="col">Preco Total</th>
                    <th scope="col">Passageiros do ticket</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                    </tr>
                </thead>

                <tbody>
                    {% for ticket in tickets %}
                        <tr>
                            <th scope="row">
                                {% if ticket.status == 'Finalizado' or ticket.status == 'Cancelado' %}
                                    <p style="color:darkgray;" >{{ ticket.id }}</p>
                                {% else %}
                                    {{ ticket.id }}
                                {% endif %}
                            </th>
                            <td>
                                {% if ticket.status == 'Finalizado' or ticket.status == 'Cancelado' %}
                                    <p style="color:darkgray;" >{{ ticket.status }}</p>
                                {% else %}
                                    {{ ticket.status }}
                                {% endif %}
                            </td>
                            <td>
                                {% for flight in flights %}
                                    {% if ticket.flight_id == flight.id %}
                                        {% if ticket.status == 'Finalizado' or ticket.status == 'Cancelado' %}
                                            <p style="color:darkgray;" >{{ passenger.first_name }} {{ passenger.last_name }}</p>
                                        {% else %}
                                            {{ passenger.first_name }} {{ passenger.last_name }}
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}   
                            </td>
                            <td>
                                {% if ticket.status == 'Finalizado' or ticket.status == 'Cancelado' %}
                                    <p style="color:darkgray;" >R$ {{ ticket.total_price }}</p>
                                {% else %}
                                    R$ {{ ticket.total_price }}
                                {% endif %}
                            </td>
                            <td>
                                {% if ticket.status == 'Finalizado' or ticket.status == 'Cancelado' %}
                                    <a href="#" class="btn btn-primary btn-sm disabled">Adicionar passageiros</a>
                                {% else %}
                                    <a href="{% url 'tickets:add_ticket_passenger' ticket.id %}" class="btn btn-primary btn-sm">Adicionar passageiros</a>
                                {% endif %}
                                <br /><br />
                                {% for ticket_passenger in ticket_passengers %}
                                    {% if ticket_passenger.ticket_id == ticket.id %}
                                        Passageiro: {{ ticket_passenger.passenger}}<br /> 
                                        Assento: {{ ticket_passenger.seat}}<br />
                                        Valor Unitario: R$ {{ ticket_passenger.unitary_price }}<br />
                                        <a href="{% url 'tickets:delete_ticket_passenger' ticket_passenger.id %}">Excluir passageiro</a><br /><br />
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                <a href="{% url 'tickets:edit_ticket_status' ticket.id %}" class="btn btn-danger btn-sm ">Alterar Status</a>
                            </td>
                            <td>
                                <a href="{% url 'tickets:delete_ticket' ticket.id %}" class="btn btn-danger btn-sm ">Excluir ticket</a>
                            </td>
                        </tr> 
                    {% endfor %}
                </tbody>

                <!--<tbody>
                    {% for ticket in tickets %}
                    <tr>
                        <th scope="row">{{ ticket.id }}</th>
                        <td>{{ ticket.flight }}</td>
                        <td>{{ ticket.price }}</td>
                        <td>{{ ticket.passenger }}</td>
                        <td>
                            <a href="{% url 'tickets:edit_ticket' ticket.id %}" class="btn btn-primary btn-sm">Editar</a>
                            <a href="{% url 'tickets:delete_ticket' ticket.id %}"
                                class="btn btn-danger btn-sm ">Excluir</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>-->

            </table>
        </div>
    </div>
</div>

{% endblock body %}